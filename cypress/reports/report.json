{
  "stats": {
    "suites": 1,
    "tests": 6,
    "passes": 5,
    "pending": 0,
    "failures": 1,
    "start": "2021-04-26T10:24:23.201Z",
    "end": "2021-04-26T10:34:58.513Z",
    "duration": 635312,
    "testsRegistered": 15,
    "passPercent": 33.33333333333333,
    "pendingPercent": 0,
    "other": 1,
    "hasOther": true,
    "skipped": 9,
    "hasSkipped": true
  },
  "results": [
    {
      "uuid": "4fb27cfe-7221-411d-8bbf-45fe2abea645",
      "title": "",
      "fullFile": "cypress\\integration\\examples\\purchase.js",
      "file": "cypress\\integration\\examples\\purchase.js",
      "beforeHooks": [],
      "afterHooks": [],
      "tests": [],
      "suites": [
        {
          "uuid": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
          "title": "Login page",
          "fullFile": "",
          "file": "",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น",
              "fullTitle": "Login page purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น",
              "timedOut": null,
              "duration": 83257,
              "state": "passed",
              "speed": "slow",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "0c2b2235-06cb-4765-bdc2-b953b5678072",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with TMN , รับที่เซเว่นอีเลฟเว่น",
              "fullTitle": "Login page purchase products | Purchase order with TMN , รับที่เซเว่นอีเลฟเว่น",
              "timedOut": null,
              "duration": 92822,
              "state": "passed",
              "speed": "slow",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "291d1f03-1f92-4eec-8b23-a796a853b6ad",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with CC , รับที่เซเว่นอีเลฟเว่น",
              "fullTitle": "Login page purchase products | Purchase order with CC , รับที่เซเว่นอีเลฟเว่น",
              "timedOut": null,
              "duration": 88283,
              "state": "passed",
              "speed": "slow",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "8015300d-e575-4c96-ba1f-24e556a17832",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with CS , จัดส่งตามที่อยู่",
              "fullTitle": "Login page purchase products | Purchase order with CS , จัดส่งตามที่อยู่",
              "timedOut": null,
              "duration": 78124,
              "state": "passed",
              "speed": "slow",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "f788ccc3-caf7-4491-b58d-ab35943732a7",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่",
              "timedOut": null,
              "duration": 90733,
              "state": "passed",
              "speed": "slow",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "d8578d4c-db6f-45b8-9cb3-0d4e09384211",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with CC , จัดส่งตามที่อยู่",
              "fullTitle": "Login page purchase products | Purchase order with CC , จัดส่งตามที่อยู่",
              "timedOut": null,
              "duration": 516,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {
                "message": "CypressError: `cy.click()` failed because it requires a DOM element.\n\nThe subject received was:\n\n  > `undefined`\n\nThe previous command that ran was:\n\n  > `cy.get()`\n\nBecause this error occurred during a `after each` hook we are skipping the remaining tests in the current suite: `Login page`",
                "estack": "CypressError: `cy.click()` failed because it requires a DOM element.\n\nThe subject received was:\n\n  > `undefined`\n\nThe previous command that ran was:\n\n  > `cy.get()`\n\nBecause this error occurred during a `after each` hook we are skipping the remaining tests in the current suite: `Login page`\n    at ensureElement (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162595:24)\n    at validateType (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162432:16)\n    at Object.ensureSubjectByType (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162468:9)\n    at pushSubjectAndValidate (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:171208:15)\n    at Context.<anonymous> (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:171545:18)\nFrom Your Spec Code:\n    at Context.eval (https://integ1.allonline.7eleven.co.th/__cypress/tests?p=cypress\\integration\\examples\\purchase.js:127:32)",
                "diff": null
              },
              "uuid": "e92d5c50-8074-455e-aff4-2e747e09aae0",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "purchase products | Purchase order with CS, รับที่เซเว่นอีเลฟเว่น, have split order",
              "fullTitle": "Login page purchase products | Purchase order with CS, รับที่เซเว่นอีเลฟเว่น, have split order",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "4ae12445-99df-42a9-9efd-8dab8b7c8818",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with CS, จัดส่งตามที่อยู่, have split order",
              "fullTitle": "Login page purchase products | Purchase order with CS, จัดส่งตามที่อยู่, have split order",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "138643b7-38da-4616-8c91-4e692ec01ee2",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น, use 500 AMB points",
              "fullTitle": "Login page purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น, use 500 AMB points",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "c6103eda-d251-4e1e-966c-3c3c883f4b48",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with CS , จัดส่งตามที่อยู่, use 500 AMB points",
              "fullTitle": "Login page purchase products | Purchase order with CS , จัดส่งตามที่อยู่, use 500 AMB points",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "1e5a35bf-bf72-4839-a71a-602dc07a1e07",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "0c6b1bd6-11d0-49fc-a6b2-5ecb191ccfd1",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion fixed amount",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion fixed amount",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "c8c43a0b-8c74-4e41-88b9-28b14cf885fd",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion percentage",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion percentage",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "db90dd5a-b5eb-4b91-96fa-e0ce8dfc9051",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "4a9cb49a-68ca-4c9c-91de-8424e104d821",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            },
            {
              "title": "purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free shipping",
              "fullTitle": "Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free shipping",
              "timedOut": null,
              "duration": 0,
              "state": "skipped",
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "// check remaining product in basket\ncy.get('span.cart-indicator').then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, '')) || 0;\n  if (num > 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion && promotion.searchType == 'myCoupon') {\n  // if(promotion.usePromotion) {\n  cy.get('a[href=\"/coupon/\"]').should('contain', 'คูปองส่วนลด').click();\n  cy.title().should('eq', 'Coupon | AllOnline');\n  cy.url().should('include', '/coupon/');\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get('.cart-indicator').should('contain', qty);\n  if (product.isSplit == 'Y') {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == 'รับที่เซเว่นอีเลฟเว่น') {\n  customerDetails = {\n    \"phoneNumber\": phoneNumber,\n    \"storeId\": storeId,\n    \"storeAddress\": storeAddress,\n    \"storeName\": storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + ' ' + splitOrderDetails.floor + ', ' + splitOrderDetails.moo + ', ' + splitOrderDetails.soi + ', ' + splitOrderDetails.street + ', ' + splitOrderDetails.subDistrict + ' ' + splitOrderDetails.district + ' ' + splitOrderDetails.province + ' ' + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == 'จัดส่งตามที่อยู่') {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + ' ' + customerDetails.floor + ', ' + customerDetails.moo + ', ' + customerDetails.soi + ', ' + customerDetails.street + ', ' + customerDetails.subDistrict + ' ' + customerDetails.district + ' ' + customerDetails.province + ' ' + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get('.item-sum').should('contain', sum);\ncy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').click();\ncy.title().should('eq', 'AllOnline');\ncy.url().should('include', '/account/basket/');\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains('ดำเนินการชำระเงิน').click(); // shipping\ncy.url().should('include', '/checkout/shipping/');\ncy.title().should('eq', 'การจัดส่ง');\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == 'Y' && haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click(); // payment\ncy.url().should('include', '/checkout/payment/');\ncy.title().should('eq', 'ชำระเงิน');\ncy.get('.basket').should(function ($basket) {\n  expect($basket).to.contain('สรุปรายการสั่งซื้อ');\n  expect($basket).to.contain(products.length + ' สินค้า');\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case 'รับที่เซเว่นอีเลฟเว่น':\n    if (haveSplitOrder) {\n      cy.get('.address').first().should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get('.address').eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get('.basket').should(function ($custAddress) {\n        expect($custAddress).to.contain('เบอร์โทรศัพท์ผู้รับสินค้า: ' + phoneNumber);\n        expect($custAddress).to.contain('เซเว่นอีเลฟเว่น #' + storeId);\n        expect($custAddress).to.contain('สาขา ' + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case 'จัดส่งตามที่อยู่':\n    cy.get('.basket').should(function ($custAddress) {\n      expect($custAddress).to.contain('เบอร์โทรติดต่อ : ' + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder && product.isSplit == 'Y') {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case 'normalRate':\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit('/');\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get('#mini-basket').should('contain', 'ตะกร้าสินค้า').dblclick();\n  cy.get('a.proceed').should('contain', 'ดำเนินการชำระเงิน').click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping('จัดส่งตามที่อยู่', searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get('button[id=\"continue-payment-btn\"]').contains('ดำเนินการชำระเงิน').click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == '') {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice >= promotion.minimum) {\n    switch (promotion.discountType) {\n      case 'percentage':\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount > 0 && promotionPrice >= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'fixedAmount':\n        cy.log('promotionPrice : ' + promotionPrice);\n        cy.log('promotion.discountAmount : ' + promotion.discountAmount);\n        if (promotionPrice >= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log('discount : ' + discount);\n        cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        break;\n      case 'freeShipping':\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get('tr.line-coupon').should('contain', promotion.id.toUpperCase());\n        }\n        break;\n      case 'freeProduct':\n        if (haveProducts == true) {\n          cy.get('#tbody-free-item > .radio-styled > .show-description').first().should('contain', promotion.freeProduct);\n          cy.get('#tbody-free-item > .radio-styled > [align=\"center\"]').first().should('contain', promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint > 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp > 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion && promotion.discountType == 'freeProduct') {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case 'freePerProduct':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          qty = product.amount * detail.qty;\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', qty);\n          break;\n        case 'fixedAmount':\n          cy.get('.items.radio-styled > .show-description').eq(freeList).should('contain', detail.name);\n          cy.get('.items.radio-styled > [align=\"center\"]').eq(freeList).should('contain', detail.qty);\n          break;\n        case 'amb':\n          amb += detail.qty;\n          break;\n        case 'ambPerAmount':\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case 'PAYATALL_CC':\n  case 'PAYATALL_TMN':\n    cy.get('.message-order-barcode').then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\" \");\n      var orderNo = words[1];\n      cy.wrap(orderNo).as('orderNo');\n    });\n    break;\n  case 'PAYATALL_CS':\n    cy.contains('เลขที่ใบแจ้งสินค้า/Invoice No:').siblings('.detail-table-right').then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as('orderNo');\n    });\n    cy.visit('/');\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get('@orderNo').then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i <= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != 'PAYATALL_CS') {\n  cy.checkAMB(customerName, amb);\n}",
              "err": {},
              "uuid": "e01d55db-a12b-4705-aa76-4762b431af04",
              "parentUUID": "3fba807a-4c34-46d2-8eaf-7cbd36e0ca29",
              "isHook": false,
              "skipped": true
            }
          ],
          "suites": [],
          "passes": [
            "0c2b2235-06cb-4765-bdc2-b953b5678072",
            "291d1f03-1f92-4eec-8b23-a796a853b6ad",
            "8015300d-e575-4c96-ba1f-24e556a17832",
            "f788ccc3-caf7-4491-b58d-ab35943732a7",
            "d8578d4c-db6f-45b8-9cb3-0d4e09384211"
          ],
          "failures": [
            "e92d5c50-8074-455e-aff4-2e747e09aae0"
          ],
          "pending": [],
          "skipped": [
            "4ae12445-99df-42a9-9efd-8dab8b7c8818",
            "138643b7-38da-4616-8c91-4e692ec01ee2",
            "c6103eda-d251-4e1e-966c-3c3c883f4b48",
            "1e5a35bf-bf72-4839-a71a-602dc07a1e07",
            "0c6b1bd6-11d0-49fc-a6b2-5ecb191ccfd1",
            "c8c43a0b-8c74-4e41-88b9-28b14cf885fd",
            "db90dd5a-b5eb-4b91-96fa-e0ce8dfc9051",
            "4a9cb49a-68ca-4c9c-91de-8424e104d821",
            "e01d55db-a12b-4705-aa76-4762b431af04"
          ],
          "duration": 433735,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        }
      ],
      "passes": [],
      "failures": [],
      "pending": [],
      "skipped": [],
      "duration": 0,
      "root": true,
      "rootEmpty": true,
      "_timeout": 2000
    }
  ],
  "meta": {
    "mocha": {
      "version": "7.0.1"
    },
    "mochawesome": {
      "options": {
        "quiet": false,
        "reportFilename": "report",
        "saveHtml": true,
        "saveJson": true,
        "consoleReporter": "spec",
        "useInlineDiffs": false,
        "code": true
      },
      "version": "6.2.2"
    },
    "marge": {
      "options": {
        "reportDir": "cypress/reports",
        "reportFilename": "report",
        "overwrite": true,
        "reportTitle": "Report Test",
        "html": true,
        "json": true,
        "charts": true
      },
      "version": "5.2.0"
    }
  }
}