<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:1,&quot;tests&quot;:6,&quot;passes&quot;:5,&quot;pending&quot;:0,&quot;failures&quot;:1,&quot;start&quot;:&quot;2021-04-26T10:24:23.201Z&quot;,&quot;end&quot;:&quot;2021-04-26T10:34:58.513Z&quot;,&quot;duration&quot;:635312,&quot;testsRegistered&quot;:15,&quot;passPercent&quot;:33.33333333333333,&quot;pendingPercent&quot;:0,&quot;other&quot;:1,&quot;hasOther&quot;:true,&quot;skipped&quot;:9,&quot;hasSkipped&quot;:true},&quot;results&quot;:[{&quot;uuid&quot;:&quot;4fb27cfe-7221-411d-8bbf-45fe2abea645&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;cypress\\integration\\examples\\purchase.js&quot;,&quot;file&quot;:&quot;cypress\\integration\\examples\\purchase.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;title&quot;:&quot;Login page&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;duration&quot;:83257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c2b2235-06cb-4765-bdc2-b953b5678072&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;duration&quot;:92822,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;291d1f03-1f92-4eec-8b23-a796a853b6ad&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with CC , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CC , รับที่เซเว่นอีเลฟเว่น&quot;,&quot;duration&quot;:88283,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8015300d-e575-4c96-ba1f-24e556a17832&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with CS , จัดส่งตามที่อยู่&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS , จัดส่งตามที่อยู่&quot;,&quot;duration&quot;:78124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f788ccc3-caf7-4491-b58d-ab35943732a7&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่&quot;,&quot;duration&quot;:90733,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8578d4c-db6f-45b8-9cb3-0d4e09384211&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with CC , จัดส่งตามที่อยู่&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CC , จัดส่งตามที่อยู่&quot;,&quot;duration&quot;:516,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;CypressError: `cy.click()` failed because it requires a DOM element.\n\nThe subject received was:\n\n  &gt; `undefined`\n\nThe previous command that ran was:\n\n  &gt; `cy.get()`\n\nBecause this error occurred during a `after each` hook we are skipping the remaining tests in the current suite: `Login page`&quot;,&quot;estack&quot;:&quot;CypressError: `cy.click()` failed because it requires a DOM element.\n\nThe subject received was:\n\n  &gt; `undefined`\n\nThe previous command that ran was:\n\n  &gt; `cy.get()`\n\nBecause this error occurred during a `after each` hook we are skipping the remaining tests in the current suite: `Login page`\n    at ensureElement (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162595:24)\n    at validateType (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162432:16)\n    at Object.ensureSubjectByType (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:162468:9)\n    at pushSubjectAndValidate (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:171208:15)\n    at Context.&lt;anonymous&gt; (https://integ1.allonline.7eleven.co.th/__cypress/runner/cypress_runner.js:171545:18)\nFrom Your Spec Code:\n    at Context.eval (https://integ1.allonline.7eleven.co.th/__cypress/tests?p=cypress\\integration\\examples\\purchase.js:127:32)&quot;},&quot;uuid&quot;:&quot;e92d5c50-8074-455e-aff4-2e747e09aae0&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;purchase products | Purchase order with CS, รับที่เซเว่นอีเลฟเว่น, have split order&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS, รับที่เซเว่นอีเลฟเว่น, have split order&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ae12445-99df-42a9-9efd-8dab8b7c8818&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with CS, จัดส่งตามที่อยู่, have split order&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS, จัดส่งตามที่อยู่, have split order&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;138643b7-38da-4616-8c91-4e692ec01ee2&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น, use 500 AMB points&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS , รับที่เซเว่นอีเลฟเว่น, use 500 AMB points&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6103eda-d251-4e1e-966c-3c3c883f4b48&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with CS , จัดส่งตามที่อยู่, use 500 AMB points&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with CS , จัดส่งตามที่อยู่, use 500 AMB points&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e5a35bf-bf72-4839-a71a-602dc07a1e07&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c6b1bd6-11d0-49fc-a6b2-5ecb191ccfd1&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion fixed amount&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion fixed amount&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c8c43a0b-8c74-4e41-88b9-28b14cf885fd&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion percentage&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion percentage&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db90dd5a-b5eb-4b91-96fa-e0ce8dfc9051&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free Product&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4a9cb49a-68ca-4c9c-91de-8424e104d821&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free shipping&quot;,&quot;fullTitle&quot;:&quot;Login page purchase products | Purchase order with TMN , จัดส่งตามที่อยู่, use coupon promotion free shipping&quot;,&quot;duration&quot;:0,&quot;state&quot;:&quot;skipped&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// check remaining product in basket\ncy.get(&#x27;span.cart-indicator&#x27;).then(function ($cartIndicator) {\n  var num = parseInt($cartIndicator.text().replace(/,/g, &#x27;&#x27;)) || 0;\n  if (num &gt; 0) {\n    cy.clearBasket();\n  }\n});\nif (promotion.usePromotion &amp;&amp; promotion.searchType == &#x27;myCoupon&#x27;) {\n  // if(promotion.usePromotion) {\n  cy.get(&#x27;a[href=\&quot;/coupon/\&quot;]&#x27;).should(&#x27;contain&#x27;, &#x27;คูปองส่วนลด&#x27;).click();\n  cy.title().should(&#x27;eq&#x27;, &#x27;Coupon | AllOnline&#x27;);\n  cy.url().should(&#x27;include&#x27;, &#x27;/coupon/&#x27;);\n  var iscated = false;\n  cy.findCoupon(promotion.id, iscated);\n  cy.checkCoupon(promotion);\n  cy.getCoupon(promotion.id);\n} // add product to basket\n\nproducts.forEach(function (product) {\n  price = formatNumber(product.price);\n  cy.searchProduct(product);\n  cy.addProduct(product, price);\n  cy.wait(1000);\n  qty += product.amount;\n  cy.get(&#x27;.cart-indicator&#x27;).should(&#x27;contain&#x27;, qty);\n  if (product.isSplit == &#x27;Y&#x27;) {\n    haveSplitOrder = true;\n    splitOrderAmount--;\n  }\n}); // check shipping address\nif (shippingType == &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;) {\n  customerDetails = {\n    \&quot;phoneNumber\&quot;: phoneNumber,\n    \&quot;storeId\&quot;: storeId,\n    \&quot;storeAddress\&quot;: storeAddress,\n    \&quot;storeName\&quot;: storeName\n  };\n  address = storeAddress;\n  if (haveSplitOrder) {\n    searchSplitAddressType = testData.splitOrderDetails.splitAddressType;\n    splitAddressPayment = splitOrderDetails.addressNo + &#x27; &#x27; + splitOrderDetails.floor + &#x27;, &#x27; + splitOrderDetails.moo + &#x27;, &#x27; + splitOrderDetails.soi + &#x27;, &#x27; + splitOrderDetails.street + &#x27;, &#x27; + splitOrderDetails.subDistrict + &#x27; &#x27; + splitOrderDetails.district + &#x27; &#x27; + splitOrderDetails.province + &#x27; &#x27; + splitOrderDetails.postalCode;\n  }\n} else if (shippingType == &#x27;จัดส่งตามที่อยู่&#x27;) {\n  customerDetails = testData.customerDetails;\n  address = customerDetails.addressNo + &#x27; &#x27; + customerDetails.floor + &#x27;, &#x27; + customerDetails.moo + &#x27;, &#x27; + customerDetails.soi + &#x27;, &#x27; + customerDetails.street + &#x27;, &#x27; + customerDetails.subDistrict + &#x27; &#x27; + customerDetails.district + &#x27; &#x27; + customerDetails.province + &#x27; &#x27; + customerDetails.postalCode;\n  haveSplitOrder = false;\n} // check product in pop up basket\n\ncy.wait(2000);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  cy.verifyPopUpBasket(product.name, product.amount, price, productList);\n  orderSum += product.amount * product.price;\n  productList++;\n});\nsum = formatNumber(orderSum);\ncy.get(&#x27;.item-sum&#x27;).should(&#x27;contain&#x27;, sum);\ncy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).click();\ncy.title().should(&#x27;eq&#x27;, &#x27;AllOnline&#x27;);\ncy.url().should(&#x27;include&#x27;, &#x27;/account/basket/&#x27;);\nproductList = 1;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  productPrice = formatNumber(product.price);\n  cy.verifyBasket(product.name, product.barcode, product.amount, productPrice, price, productList);\n  productList++;\n});\ncy.contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/shipping/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;การจัดส่ง&#x27;);\ncy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\nproductList = 1;\nproductSplitList = 1;\nproducts.forEach(function (product) {\n  if (product.isSplit == &#x27;Y&#x27; &amp;&amp; haveSplitOrder) {\n    cy.verifyOrder(product.name, product.barcode, productSplitList, product.isSplit, haveSplitOrder);\n    productSplitList++;\n  } else {\n    cy.verifyOrder(product.name, product.barcode, productList, product.isSplit, haveSplitOrder);\n    productList++;\n  }\n});\nif (haveSplitOrder) {\n  cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n}\ncy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click(); // payment\ncy.url().should(&#x27;include&#x27;, &#x27;/checkout/payment/&#x27;);\ncy.title().should(&#x27;eq&#x27;, &#x27;ชำระเงิน&#x27;);\ncy.get(&#x27;.basket&#x27;).should(function ($basket) {\n  expect($basket).to.contain(&#x27;สรุปรายการสั่งซื้อ&#x27;);\n  expect($basket).to.contain(products.length + &#x27; สินค้า&#x27;);\n  expect($basket).to.contain(customerName);\n});\nswitch (shippingType) {\n  case &#x27;รับที่เซเว่นอีเลฟเว่น&#x27;:\n    if (haveSplitOrder) {\n      cy.get(&#x27;.address&#x27;).first().should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(storeName);\n        expect($custAddress).to.contain(address);\n      });\n      cy.get(&#x27;.address&#x27;).eq(2).should(function ($custAddress) {\n        expect($custAddress).to.contain(customerName);\n        expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n        expect($custAddress).to.contain(splitAddressPayment);\n      });\n    } else {\n      cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n        expect($custAddress).to.contain(&#x27;เบอร์โทรศัพท์ผู้รับสินค้า: &#x27; + phoneNumber);\n        expect($custAddress).to.contain(&#x27;เซเว่นอีเลฟเว่น #&#x27; + storeId);\n        expect($custAddress).to.contain(&#x27;สาขา &#x27; + storeName);\n        expect($custAddress).to.contain(address);\n      });\n    }\n    break;\n  case &#x27;จัดส่งตามที่อยู่&#x27;:\n    cy.get(&#x27;.basket&#x27;).should(function ($custAddress) {\n      expect($custAddress).to.contain(&#x27;เบอร์โทรติดต่อ : &#x27; + phoneNumber);\n      expect($custAddress).to.contain(address);\n    });\n    break;\n}\norderSum = 0;\nproductList = 0;\nproducts.forEach(function (product) {\n  price = formatNumber(product.amount * product.price);\n  if (haveSplitOrder &amp;&amp; product.isSplit == &#x27;Y&#x27;) {\n    cy.verifyOrderAtPayment(product, price, splitOrderAmount);\n    splitOrderAmount++;\n  } else {\n    cy.verifyOrderAtPayment(product, price, productList);\n    productList++;\n  }\n  if (product.getAMB) {\n    priceAMB += product.price * product.amount;\n  }\n  switch (product.mstampType) {\n    case &#x27;normalRate&#x27;:\n      priceMStamp += product.price * product.amount;\n  }\n  orderSum += product.amount * product.price;\n});\nif (promotion.usePromotion) {\n  cy.typePromotion(promotion);\n  cy.visit(&#x27;/&#x27;);\n  cy.login(loginUsername, loginPassword, username, isReLogin);\n  cy.wait(2000);\n  cy.get(&#x27;#mini-basket&#x27;).should(&#x27;contain&#x27;, &#x27;ตะกร้าสินค้า&#x27;).dblclick();\n  cy.get(&#x27;a.proceed&#x27;).should(&#x27;contain&#x27;, &#x27;ดำเนินการชำระเงิน&#x27;).click(); // shipping\n  cy.verifyShipping(shippingType, searchAddrType, customerDetails, taxInvoice);\n  if (haveSplitOrder) {\n    cy.verifyShipping(&#x27;จัดส่งตามที่อยู่&#x27;, searchSplitAddressType, splitOrderDetails, taxInvoice, haveSplitOrder);\n  }\n  cy.get(&#x27;button[id=\&quot;continue-payment-btn\&quot;]&#x27;).contains(&#x27;ดำเนินการชำระเงิน&#x27;).click();\n  cy.wait(2000);\n  cy.checkPromotion(promotion); // calculate promotion\n  var promotionPrice = 0;\n  var haveProducts = false;\n  if (promotion.type == &#x27;&#x27;) {\n    promotionPrice = orderSum;\n  } else {\n    products.forEach(function (product) {\n      if (promotion.type == product.type) {\n        promotionPrice += product.price * product.amount;\n        haveProducts = true;\n      }\n    });\n  }\n  if (promotionPrice &gt;= promotion.minimum) {\n    switch (promotion.discountType) {\n      case &#x27;percentage&#x27;:\n        promotionPrice = parseInt(promotionPrice * (promotion.discountAmount / 100));\n        if (promotion.maxDiscount &gt; 0 &amp;&amp; promotionPrice &gt;= promotion.maxDiscount) {\n          discount = promotion.maxDiscount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;fixedAmount&#x27;:\n        cy.log(&#x27;promotionPrice : &#x27; + promotionPrice);\n        cy.log(&#x27;promotion.discountAmount : &#x27; + promotion.discountAmount);\n        if (promotionPrice &gt;= promotion.discountAmount) {\n          discount = promotion.discountAmount;\n        } else {\n          discount = promotionPrice;\n        }\n        cy.log(&#x27;discount : &#x27; + discount);\n        cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        break;\n      case &#x27;freeShipping&#x27;:\n        if (haveProducts == true) {\n          shippingFee = 0;\n          cy.get(&#x27;tr.line-coupon&#x27;).should(&#x27;contain&#x27;, promotion.id.toUpperCase());\n        }\n        break;\n      case &#x27;freeProduct&#x27;:\n        if (haveProducts == true) {\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; .show-description&#x27;).first().should(&#x27;contain&#x27;, promotion.freeProduct);\n          cy.get(&#x27;#tbody-free-item &gt; .radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).first().should(&#x27;contain&#x27;, promotion.freeQty);\n        }\n        break;\n    }\n  }\n}\nif (discountAMBPoint &gt; 0) {\n  cy.discountAMB(discountAMBPoint, formatNumber(discountAMBBath));\n}\nif (discountMstamp &gt; 0) {\n  cy.discountMstamp(discountMstamp);\n} // check promotion on product\n\nproducts.forEach(function (product) {\n  if (product.promotion.hasPromotion) {\n    if (promotion.usePromotion &amp;&amp; promotion.discountType == &#x27;freeProduct&#x27;) {\n      freeList++;\n    }\n    product.promotion.details.forEach(function (detail) {\n      switch (detail.type) {\n        case &#x27;freePerProduct&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          qty = product.amount * detail.qty;\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, qty);\n          break;\n        case &#x27;fixedAmount&#x27;:\n          cy.get(&#x27;.items.radio-styled &gt; .show-description&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.name);\n          cy.get(&#x27;.items.radio-styled &gt; [align=\&quot;center\&quot;]&#x27;).eq(freeList).should(&#x27;contain&#x27;, detail.qty);\n          break;\n        case &#x27;amb&#x27;:\n          amb += detail.qty;\n          break;\n        case &#x27;ambPerAmount&#x27;:\n          qty = parseInt(product.amount / detail.amount);\n          amb += detail.qty * qty;\n      }\n      freeList++;\n    });\n  }\n});\nsum = formatNumber(orderSum);\ntotalPrice = orderSum + shippingFee - discount - discountAMBBath - discountMstamp;\namb += parseInt((priceAMB - discount - discountAMBBath - discountMstamp) / 10) * 3;\nmstamp = parseInt((priceMStamp - discount - discountAMBBath - discountMstamp) / 50);\ncy.verifyTotalPrice(sum, formatNumber(shippingFee), formatNumber(totalPrice), amb, mstamp, discount, promotion.usePromotion, discountAMBBath, discountMstamp);\ncy.payment(paymentDetails);\ncy.checkReceipt(paymentDetails, customerName, formatNumber(totalPrice.toFixed(2)));\nswitch (paymentDetails.paymentType) {\n  case &#x27;PAYATALL_CC&#x27;:\n  case &#x27;PAYATALL_TMN&#x27;:\n    cy.get(&#x27;.message-order-barcode&#x27;).then(function ($text) {\n      var text = $text.text();\n      var words = text.trim().split(\&quot; \&quot;);\n      var orderNo = words[1];\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    break;\n  case &#x27;PAYATALL_CS&#x27;:\n    cy.contains(&#x27;เลขที่ใบแจ้งสินค้า/Invoice No:&#x27;).siblings(&#x27;.detail-table-right&#x27;).then(function ($orderNo) {\n      var orderNo = $orderNo.text();\n      cy.wrap(orderNo).as(&#x27;orderNo&#x27;);\n    });\n    cy.visit(&#x27;/&#x27;);\n    cy.login(loginUsername, loginPassword, username, isReLogin);\n    break;\n}\ncy.get(&#x27;@orderNo&#x27;).then(function (orderNo) {\n  if (!haveSplitOrder) {\n    cy.checkStatusOrder(orderNo);\n  } else {\n    var orderLength = orderNo.length;\n    for (var i = 1; i &lt;= 2; i++) {\n      orderNo = orderNo.substring(0, orderLength - 2) + i + orderNo.substring(orderLength - 1);\n      cy.checkStatusOrder(orderNo);\n    }\n  }\n});\nif (paymentDetails.paymentType != &#x27;PAYATALL_CS&#x27;) {\n  cy.checkAMB(customerName, amb);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e01d55db-a12b-4705-aa76-4762b431af04&quot;,&quot;parentUUID&quot;:&quot;3fba807a-4c34-46d2-8eaf-7cbd36e0ca29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c2b2235-06cb-4765-bdc2-b953b5678072&quot;,&quot;291d1f03-1f92-4eec-8b23-a796a853b6ad&quot;,&quot;8015300d-e575-4c96-ba1f-24e556a17832&quot;,&quot;f788ccc3-caf7-4491-b58d-ab35943732a7&quot;,&quot;d8578d4c-db6f-45b8-9cb3-0d4e09384211&quot;],&quot;failures&quot;:[&quot;e92d5c50-8074-455e-aff4-2e747e09aae0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;4ae12445-99df-42a9-9efd-8dab8b7c8818&quot;,&quot;138643b7-38da-4616-8c91-4e692ec01ee2&quot;,&quot;c6103eda-d251-4e1e-966c-3c3c883f4b48&quot;,&quot;1e5a35bf-bf72-4839-a71a-602dc07a1e07&quot;,&quot;0c6b1bd6-11d0-49fc-a6b2-5ecb191ccfd1&quot;,&quot;c8c43a0b-8c74-4e41-88b9-28b14cf885fd&quot;,&quot;db90dd5a-b5eb-4b91-96fa-e0ce8dfc9051&quot;,&quot;4a9cb49a-68ca-4c9c-91de-8424e104d821&quot;,&quot;e01d55db-a12b-4705-aa76-4762b431af04&quot;],&quot;duration&quot;:433735,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;7.0.1&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;6.2.2&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;cypress/reports&quot;,&quot;reportFilename&quot;:&quot;report&quot;,&quot;overwrite&quot;:true,&quot;reportTitle&quot;:&quot;Report Test&quot;,&quot;html&quot;:true,&quot;json&quot;:true,&quot;charts&quot;:true},&quot;version&quot;:&quot;5.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;report&quot;,&quot;reportDir&quot;:&quot;cypress/reports&quot;,&quot;reportTitle&quot;:&quot;Report Test&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;cypress\\reports\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\Users\\sunitakac\\Documents\\allonlineTest\\cypress\\reports\\report.json&quot;,&quot;htmlFile&quot;:&quot;D:\\Users\\sunitakac\\Documents\\allonlineTest\\cypress\\reports\\report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>